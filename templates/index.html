<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - TaskManager</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
 /* Base Styles */
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

.container {
  max-width: 1100px;
  margin: 30px auto 0;
  padding: 0 15px;
}

h2 {
  margin-bottom: 20px;
}

/* Navbar & Branding */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #3498db;
  color: white;
  padding: 15px 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.brand {
  display: flex;
  align-items: center;
  gap: 15px;
}

.brand img {
  width: 40px;
  height: 40px;
  border-radius: 5px;
}

.brand h1 {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-weight: 600;
  font-size: 1.8rem;
  color: white;
  margin: 0;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}

/* User Section */
.user-info-bar {
  background-color: #f8f9fa;
  padding: 10px 0;
  border-bottom: 1px solid #dee2e6;
}

.user-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.welcome-msg {
  font-size: 1.1rem;
  font-weight: 500;
  color: #495057;
}

.logout-btn, .logout-button {
  padding: 8px 16px;
  font-size: 0.9rem;
  background-color: white;
  color: #dc3545;
  border: none;
  border-radius: 5px;
  font-weight: bold;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.logout-btn:hover, .logout-button:hover {
  background-color: #f2f2f2;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-lg {
  padding: 12px 24px;
  font-size: 1.1rem;
  min-width: 220px;
  text-align: center;
}

.btn-sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

.button-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  margin: 1.5rem 0;
}

/* Forms */
.form-container {
  max-width: 500px;
  margin: 0 auto;
  padding: 1rem;
}

.compact-form {
  padding: 1rem;
}

.compact-form .form-control,
.compact-form .form-select {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

.compact-form .form-label {
  margin-bottom: 0.2rem;
  font-size: 0.875rem;
}

.btn-submit {
  margin-top: 10px;
}

/* Tables */
.table {
  margin-top: 20px;
  width: 100%;
}

.table th {
  background-color: #4CAF50;
  color: white;
  padding: 0.5rem;
}

.table td {
  padding: 0.3rem 0.5rem;
  vertical-align: middle;
}

.table tr:hover {
  background-color: #f5f5f5;
}

.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Tooltips */
input[title]:hover:after {
  content: attr(title);
  padding: 5px 10px;
  color: #333;
  background: #f8f9fa;
  border: 1px solid #ddd;
  border-radius: 4px;
  position: absolute;
  left: 0;
  top: 100%;
  z-index: 100;
  width: 200px;
  margin-top: 5px;
}

/* Modals & Popups */
.popup-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.popup-container.show {
  opacity: 1;
}

.popup-content {
  background: white;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  max-width: 80%;
  text-align: center;
}

.popup-content button {
  margin-top: 15px;
  padding: 5px 15px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

.modal-dialog {
  max-width: 600px;
}

/* Toast Notifications */
.swal2-toast {
  font-size: 14px !important;
  padding: 10px 15px !important;
}

.swal2-success {
  background-color: #4CAF50 !important;
}

.swal2-error {
  background-color: #dc3545 !important;
}

/* Animations & Transitions */
#taskListContainer {
  transition: all 0.3s ease;
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }

  .navbar {
    flex-direction: column;
    padding: 10px;
  }

  .brand h1 {
    font-size: 1.5rem;
  }

  .user-section {
    margin-top: 10px;
  }

  .welcome-msg {
    font-size: 1rem;
  }

  .logout-btn {
    padding: 6px 12px;
    font-size: 0.8rem;
  }

  table {
    display: block;
    overflow-x: auto;
  }

  .btn-lg {
    min-width: auto;
    width: 100%;
  }
}
    /* Main Content Container */
.main-content {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 15px;
}

/* Form Section */
.form-section {
    margin-bottom: 1.5rem;
}

/* Search and Filter Row */
.search-filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
    align-items: center;
}

.search-box {
    flex: 1;
    min-width: 300px;
}

.filter-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Progress Bar Section */
.progress-section {
    margin: 1.5rem 0;
}

.progress {
    height: 30px;
    border-radius: 15px;
}

.progress-bar {
    font-size: 0.95rem;
    font-weight: 500;
}

/* Status Filter Buttons */
.status-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.status-filters .btn {
    flex: 1;
    min-width: 120px;
}

/* Table Container */
.table-container {
    width: 100%;
    overflow-x: auto;
    margin-bottom: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.table {
    margin-bottom: 0;
    font-size: 0.9rem;
}

.table th {
    padding: 0.75rem;
    white-space: nowrap;
}

.table td {
    padding: 0.75rem;
    vertical-align: middle;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .search-filter-row {
        flex-direction: column;
    }

    .search-box,
    .filter-buttons {
        width: 100%;
    }

    .status-filters .btn {
        min-width: calc(50% - 0.5rem);
    }
}

@media (max-width: 576px) {
    .status-filters .btn {
        min-width: 100%;
    }
}
    /* Add this to your CSS */
.main-content {
    margin-top: 2rem; /* Adds space below the header */
    padding-top: 1rem;
}
    /* Update these color styles */
.navbar {
    background-color: #2c3e50; /* Darker blue for navbar */
}

.btn-primary {
    background-color: #3498db;
    border-color: #2980b9;
}

.btn-primary:hover {
    background-color: #2980b9;
}

.btn-success {
    background-color: #27ae60;
    border-color: #219653;
}

.btn-warning {
    background-color: #f39c12;
    border-color: #e67e22;
}

.btn-info {
    background-color: #00b4d8; /* Brighter info blue */
    border-color: #0096c7;
}

.btn-danger {
    background-color: #e74c3c;
    border-color: #c0392b;
}

/* Form styling */
#taskFormContainer {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
}

/* Status filter buttons */
.btn-outline-primary {
    color: #3498db;
    border-color: #3498db;
}

.btn-outline-warning {
    color: #f39c12;
    border-color: #f39c12;
}

.btn-outline-info {
    color: #00b4d8;
    border-color: #00b4d8;
}

.btn-outline-success {
    color: #27ae60;
    border-color: #27ae60;
}

/* Table action buttons */
.btn-sm.btn-primary {
    background-color: #3498db;
}

.btn-sm.btn-info {
    background-color: #00b4d8;
}

.btn-sm.btn-danger {
    background-color: #e74c3c;
}

/* Progress bar */
.progress-bar {
    background-color: #27ae60;
}
</style>
<style>
  body {
    background-color: #f8fafa;
  }

   body {
  background: linear-gradient(120deg, #f8f9fa, #e9ecef);
}

  body {
    font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
  }

  .card {
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .cursor-pointer {
  cursor: pointer;
}

  .btn-primary {
    background-color: #0dc1fd;
    border-color: #7398ce;
  }

  .btn-primary:hover {
    background-color: #abbbd3;
  }

  .btn-secondary {
    background-color: #6c757d;
    border-color: #6f8c93;
  }

  .btn-secondary:hover {
    background-color: #8fa2b5;
  }

  #taskList .card:hover {
    transform: scale(1.01);
    transition: transform 0.2s ease;
  }

  th, td {
    vertical-align: middle !important;
  }

  #taskSection {
  padding: 30px;
  border-radius: 12px;
  background-color: #ffffff;
  box-shadow: 0 0 20px rgba(0,0,0,0.05);
}

  #taskDetailsSection {
    background-color: #fefefe;
  }


  .progress {
    height: 24px;
    border-radius: 8px;
    overflow: hidden;
  }

  .progress-bar {
    font-weight: bold;
    font-size: 14px;
  }

  .table thead th {
    background-color: #343a40 !important;
    color: white;
  }

  .btn-group .btn {
    border-radius: 0.375rem;
  }

  #taskList .table {
  margin-bottom: 40px;
  border-radius: 10px;
  overflow: hidden;
}
/* Add these styles */
.header-spacer {
    margin: 1.5rem 0;
}

.card {
    border-radius: 10px;
    overflow: hidden;
}

.table {
    border-collapse: separate;
    border-spacing: 0;
}

.table th {
    background-color: #2c3e50 !important; /* Matching navbar */
}

.table tr:hover {
    background-color: #f8f9fa !important;
}

.btn-lg {
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Status badges */
.badge-primary {
    background-color: #3498db;
}
.badge-warning {
    background-color: #f39c12;
}
.badge-info {
    background-color: #00b4d8;
}
.badge-success {
    background-color: #27ae60;
}
    /* Welcome message styling */
.text-center.py-5 {
    padding: 3rem 0;
}

.fa-tasks.fa-4x {
    opacity: 0.7;
}
    /* Add to your existing CSS */
.progress-section, .table-container {
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
    /* Status filter buttons */
.status-filters .btn {
    transition: all 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Make sure buttons don't jump when counts appear */
.status-filters .btn i {
    margin-right: 4px;
}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid justify-content-center">
    <div class="brand">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
      <h1 class="m-0">TaskManager</h1>
    </div>
  </div>
</nav>
<div class="user-info-bar">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col text-start text-md-center ps-md-5">
        <span class="welcome-msg">Welcome, {{ session.get('username') }}</span>
      </div>
      <div class="col text-end text-md-center pe-md-5">
        <form action="/logout" method="post">
         <button type="submit" class="btn btn-danger">
    <i class="fas fa-sign-out-alt"></i> Logout
</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="header-spacer" style="height: -20px;"></div>
  <div class="container main-content">
    <!-- Add Task Button and Form -->
    <div class="form-section text-center">
        <button id="toggleTaskForm" class="btn btn-primary btn-lg mb-3">
            <i class="fas fa-plus"></i> <span id="toggleButtonText">Add New Task</span>
        </button>

        <div id="taskFormContainer" style="display: none;" class="card shadow-sm border-0">
  <div class="card-body">
    <h5 class="card-title mb-4">Add New Task</h5>
    <form action="/add_task" method="POST">
    <div class="mb-2">
      <label for="title" class="form-label">Task Title</label>
      <input type="text" class="form-control" id="title" name="title" required>
    </div>
    <div class="mb-2">
      <label for="description" class="form-label">Description</label>
      <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
    </div>
    <div class="mb-3">
      <label for="deadline" class="form-label">Deadline</label>
      <input type="date" class="form-control" id="deadline" name="deadline" required>
    </div>
    <button type="submit" class="btn btn-success w-100 mt-3">
        <i class="fas fa-check me-2"></i> Submit Task
      </button>
    </form>
  </div>
</div>

<!-- Status Filters -->
<div class="status-filters">
    <a href="/?status=all" class="btn {% if selected_status == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
        <i class="fas fa-tasks"></i> View All{% if selected_status == 'all' %} ({{ total_count }}){% endif %}
    </a>
    <a href="/?status=Pending" class="btn {% if selected_status == 'Pending' %}btn-warning text-dark{% else %}btn-outline-warning{% endif %}">
        <i class="fas fa-clock"></i> Pending{% if selected_status == 'Pending' %} ({{ Pending_count }}){% endif %}
    </a>
    <a href="/?status=In Progress" class="btn {% if selected_status == 'In Progress' %}btn-info text-dark{% else %}btn-outline-info{% endif %}">
        <i class="fas fa-spinner"></i> In Progress{% if selected_status == 'In Progress' %} ({{ In_Progress_count }}){% endif %}
    </a>
    <a href="/?status=Completed" class="btn {% if selected_status == 'Completed' %}btn-success{% else %}btn-outline-success{% endif %}">
        <i class="fas fa-check-circle"></i> Completed{% if selected_status == 'Completed' %} ({{ Completed_count }}){% endif %}
    </a>
</div>
        <!-- Search and Sort Row -->
    <div class="search-filter-row">
        <div class="search-box">
            <form method="get" class="d-flex gap-2">
                <input class="form-control" type="search" placeholder="Search by title" name="search" value="{{ request.args.get('search', '') }}">
                <button class="btn btn-outline-primary" type="submit">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
        </div>
        <div class="filter-buttons">
            <a href="{{ url_for('index', search=request.args.get('search', ''), status=request.args.get('status', ''), sort='deadline') }}"
               class="btn btn-outline-secondary">
                <i class="fas fa-sort-amount-down"></i> Sort by Deadline
            </a>
        </div>
    </div>
<!-- Progress Bar - Only shown when a filter is selected -->
{% if show_progress %}
<div class="progress-section">
    <div class="progress">
        <div id="taskProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success"
             role="progressbar" style="width: {{ overall_completed_percentage }}%;"
             aria-valuenow="{{ overall_completed_percentage }}" aria-valuemin="0" aria-valuemax="100">
            {{ overall_completed_percentage }}% Completed
        </div>
    </div>
</div>
{% endif %}
     <!-- Task Table - Only shown when a filter is selected -->
{% if show_table %}
<div class="table-container">
    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>Title</th>
                <th>Deadline</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if not tasks %}
                <tr>
                    <td colspan="4" class="text-center">
                        No tasks found here
                    </td>
                </tr>
            {% else %}
                {% for task in tasks %}
                <tr data-task-id="{{ task.id }}">
                    <td>{{ task.title }}</td>
                    <td>{{ task.deadline }}</td>
                    <td>{{ task.status }}</td>
                    <td>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary btn-sm"
                                onclick="editTask('{{ task.id }}', '{{ task.title }}', `{{ task.description }}`, '{{ task.deadline }}', '{{ task.status }}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-info" onclick='showDetails({{ task | tojson | safe }})'>
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                            <a href="#" onclick="deleteTask('{{ task.id }}')" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash-alt"></i> Delete
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>
{% endif %}
</div>

<!-- Your custom script to show details -->
<script>
    function showDetails(task) {
    const modalBody = document.getElementById("modalBody");
    modalBody.innerHTML = `
      <p><strong>Title:</strong> ${task.title}</p>
      <p><strong>Description:</strong> ${task.description}</p>
      <p><strong>Deadline:</strong> ${task.deadline}</p>
      <p><strong>Status:</strong> ${task.status}</p>
      <p><strong>Created At:</strong> ${task.created_at}</p>
    `;
    const myModal = new bootstrap.Modal(document.getElementById('taskModal'));
    myModal.show();
  }
function deleteTask(id) {
  Swal.fire({
    title: 'Are you sure?',
    text: "You won't be able to revert this!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "/delete_task/" + id;
    }
  });
}
document.addEventListener("DOMContentLoaded", function () {
    const rows = document.querySelectorAll("table tbody tr");
    const now = new Date();

    rows.forEach(row => {
        const deadlineText = row.children[1].innerText.trim();
        if (!deadlineText) return;

        const deadline = new Date(deadlineText);
        const timeDiff = deadline - now;
        const daysDiff = timeDiff / (1000 * 60 * 60 * 24);

        if (daysDiff < 0) {
            // Past due
            row.style.backgroundColor = "#ffcccc"; // Light red
        } else if (daysDiff < 1) {
            // Due today
            row.style.backgroundColor = "#ffe6cc"; // Light orange
        } else if (daysDiff < 3) {
            // Due in 1-2 days
            row.style.backgroundColor = "#ffffcc"; // Light yellow
        }
    });
});
</script>


<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="taskModalLabel">Task Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Details will be injected here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Task Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="/update" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Task</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
       <input type="hidden" id="editTaskId" name="task_id">
        <div class="mb-3">
          <label>Title</label>
          <input type="text" id="editTaskTitle" name="title" class="form-control">
        </div>
        <div class="mb-3">
          <label>Description</label>
          <textarea id="editTaskDescription" name="description" class="form-control"></textarea>
        </div>
        <div class="mb-3">
          <label>Deadline</label>
          <input type="date" id="editTaskDeadline" name="deadline" class="form-control">
        </div>
        <div class="mb-3">
          <label>Status</label>
          <select id="editTaskStatus" name="status" class="form-select">
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Update Task</button>
      </div>
    </form>
  </div>
</div>

<script>
   function editTask(id, title, description, deadline, status) {
    // Format date for input[type=date]
    let formattedDeadline = '';
    if (deadline) {
        const dateParts = deadline.split('-');
        if (dateParts.length === 3) {
            formattedDeadline = deadline; // Already in YYYY-MM-DD format
        } else {
            // Handle other date formats if needed
            const dateObj = new Date(deadline);
            formattedDeadline = dateObj.toISOString().split('T')[0];
        }
    }

    document.getElementById("editTaskId").value = id;
    document.getElementById("editTaskTitle").value = title;
    document.getElementById("editTaskDescription").value = description;
    document.getElementById("editTaskDeadline").value = formattedDeadline;
    document.getElementById("editTaskStatus").value = status;

    new bootstrap.Modal(document.getElementById("editModal")).show();


    }
</script>
<script>
  document.getElementById("searchInput").addEventListener("keyup", function () {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("tbody tr");

    rows.forEach(row => {
      const titleCell = row.querySelector("td:nth-child(1)"); // ‚Üê column 1 = Title
      if (titleCell) {
        const titleText = titleCell.textContent.toLowerCase();
        row.style.display = titleText.includes(filter) ? "" : "none";
      }
    });
  });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const rows = document.querySelectorAll("table tbody tr");

        rows.forEach(row => {
            const deadlineText = row.children[1].innerText.trim();
            const deadline = new Date(deadlineText + 'T23:59:59');  // force end of day
            const now = new Date();

            const timeDiff = deadline - now;
            const hoursDiff = timeDiff / (1000 * 60 * 60);

            if (hoursDiff < 24 && hoursDiff > 0) {
                row.style.backgroundColor = "#dc3545"; // Bootstrap danger red
row.style.color = "white";             // white text for contrast
row.style.fontWeight = "bold";

            }
        });
    });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        document.addEventListener('DOMContentLoaded', function() {
            {% for category, message in messages %}
                showToast('{{ category }}', '{{ message }}');
            {% endfor %}
        });
    {% endif %}
{% endwith %}
  function closePopup() {
  document.getElementById('errorPopup').style.display = 'none';
}
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('form[action="/add_task"]').addEventListener('submit', function(e) {
        e.preventDefault(); // Always prevent default first

        const form = e.target;
        const title = form.querySelector('#title').value.trim();
        const description = form.querySelector('#description').value.trim();
        const deadline = form.querySelector('#deadline').value;
        const submitBtn = form.querySelector('button[type="submit"]');

        // Validate inputs
        let isValid = true;

        if (!title) {
            showToast('error', 'Task title is required');
            isValid = false;
        }

        if (!description) {
            showToast('error', 'Task description is required');
            isValid = false;
        }

        if (deadline) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const deadlineDate = new Date(deadline);
            deadlineDate.setHours(0, 0, 0, 0);

            if (deadlineDate < today) {
                showToast('error', 'Deadline cannot be in the past');
                isValid = false;
            }
        }

        // Only submit if valid
        if (isValid) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...';
            form.submit(); // Manually submit if valid
        }
    });

    function showToast(type, message) {
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });

        Toast.fire({
            icon: type,
            title: message
        });
    }
});
</script>
<script>
document.getElementById('toggleTaskForm').addEventListener('click', function() {
    const formContainer = document.getElementById('taskFormContainer');
    const buttonText = document.getElementById('toggleButtonText');

    if (formContainer.style.display === 'none' || !formContainer.style.display) {
        formContainer.style.display = 'block';
        buttonText.textContent = 'Hide Form';
        this.querySelector('i').className = 'fas fa-minus';
    } else {
        formContainer.style.display = 'none';
        buttonText.textContent = 'Add New Task';
        this.querySelector('i').className = 'fas fa-plus';
    }
});
</script>
</body>
</html>
